<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: cppPosit Implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">cppPosit Implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The C++ Posit library provides an implementation of Posits using C++ Template. The library aims at providing flexibility for the developer/scientists in experiumenting with this new type of number representation and performance. Performance is obtained by</p>
<p>The library supports many variants of the Posits as controlled by the template parameters:</p>
<p>template &lt;class T,int totalbits, int esbits, class FT, bool withnan&gt;</p>
<ul>
<li>this is a Posit with totalbits size and it is stored in an storage type of class T whose sie is smaller than totalbits.</li>
<li>totalbits can go from 2 to 63</li>
<li>esbits is the maximum exponent size in bits. Values from 0 to totalbits-1 are support</li>
<li>FT is the data type that holds the fractional part during operations</li>
<li>withnan is a boolean flags that activates the Posit With NaN extension (see below)</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<p>Number Representation:</p><ul>
<li>posits from 4 to 64 bits</li>
<li>any exponent size</li>
<li>multiple variants of posit special numbers (see later)</li>
</ul>
<p>Storage and Performance:</p><ul>
<li>posits are being stored in larger containers user selectable</li>
<li>all bit operations</li>
</ul>
<p>Operation Implementation:</p><ul>
<li>layering of operation implementation from L1 (bit manipulations) to L4 (backend)</li>
<li>multiple backend possible: softfloat, fixed point, native floating point</li>
</ul>
<p>Tabulated Operations:</p><ul>
<li>the library supports tabulated operations for different posit types and exp/log approx</li>
</ul>
<p>Library Implementation:</p><ul>
<li>C++11 is the minimum</li>
<li>C++14 allows for more constant operations</li>
</ul>
<p>Examples:</p><ul>
<li>sets of examples</li>
<li>integration with Eigen, tinyDNN, nanoflann</li>
</ul>
<p>Target Platforms:</p><ul>
<li>natively built on Desktop, occasionally on Arm</li>
<li>tested for code generation to Xilinx FPGA using Vivado</li>
</ul>
<p>Testing:</p><ul>
<li>unit tests for selected parts</li>
<li>interactive unit tests using cling interpreter</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Building</h1>
<p>Testing on Travis (GCC) and Appveyor (MSVC): <a href="https://travis-ci.com/eruffaldi/cppPosit"><img src="https://travis-ci.com/eruffaldi/cppPosit.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Comparison with other Posit in C++</h1>
<ul>
<li><a href="https://github.com/libcg/bfp">https://github.com/libcg/bfp</a> posit sizes specified dynamically by Clement Guerin</li>
<li><a href="https://github.com/stillwater-sc/universal">https://github.com/stillwater-sc/universal</a> template based using bitset</li>
<li><a href="https://github.com/Etaphase/FastSigmoids.jla">https://github.com/Etaphase/FastSigmoids.jla</a> starting from Julia and emitting C++. Based on float ops</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Posit special numbers</h1>
<p>In some scenarios it is needed to have a treatment of NaN and signed infinity compatible with IEEE floats. For this reason I have introduced a Posit modality with these features. The implementation is straightforward and compatible with the properties of Posit:</p>
<ul>
<li>NaN is opposite position to 0 that is 1(0)+ (e.g. 100000000 in 8bit), usually represented by Infinity</li>
<li>Positive and Negative infinities are on the right and left of the NaN, each negation of the other: 0(1)+ and 1(0)+1</li>
<li>it respect ordering of values</li>
<li>unfortunately we need to give away for the maximum value</li>
</ul>
<p><img src="doc/posit_with_nan.png" alt="Posit with NaN" style="height: 200px;" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Tools</h1>
<p>Listposits allows to print the stats about any supported Posit type or list all the values and some operations. Due to the fact that we specify it using compile time types it is better to use the cling interpreter. Listposits allows for printing many different stats based on a printf like interface. </p><pre class="fragment">    H: head only
    N: no header
    I: inverse
    2: twice
    A: half
    U: unsigned order instead of signed order
    B: binary output emitting all doubles without header

    i: signed integer
    b: binary form
    v: float valu
    u: unpacked form
    p: posit object print

    k: k factor
    e: exponent
</pre><p> The script in scripts/listpositany eases the use. The following is similar to the lookup result for posit 4 and exp 1. </p><pre class="fragment">listpositany.sh int16_t,4,1,uint16_t,false -DLISTFORMAT=Uibkerv
</pre> <h1><a class="anchor" id="autotoc_md6"></a>
Operation Implementation Level</h1>
<p>We define 4 level of operations for working with Posits, then in the next section we show the level of implementation of every level:</p>
<ul>
<li>Level 1: binary manipulation of the posit in the storage type</li>
<li>Level 2: decoding of the fields (S R E F) in storage type without building the exponent</li>
<li>Level 3: using a fully unpacked version (S EXP F) with the full exponent and extended fraction</li>
<li>Level 4: native IEEE float</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">op   </th><th class="markdownTableHeadNone">level   </th><th class="markdownTableHeadNone">notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">classify(x)   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-x   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x &lt;=&gt; y   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">inv(x)   </td><td class="markdownTableBodyNone">2 (if F=0) 3 otherwise   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x/2   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2x   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x+y   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">x*y   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x/y   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">exp2(x)   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-&gt; float   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;- float   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md7"></a>
Valids</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">op   </th><th class="markdownTableHeadNone">level   </th><th class="markdownTableHeadNone">notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">classify(x)   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-x   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x &lt;=&gt; y   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">inv(x)   </td><td class="markdownTableBodyNone">1 (exact)   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x/2   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2x   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x+y   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">x*y   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x/y   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">exp2(x)   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-&gt; float   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;- float   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h1><a class="anchor" id="autotoc_md8"></a>
Value Classes and Posit Encoding</h1>
<p>A Posit is encoded as a signed integer with complement 2 sign representation. The first MSB is the sign and operations on negative posit are executed typically after absolute value. The second MSB is the inversion bit that is used to mark values above one and the ones below.</p>
<p>Important numbers:</p><ul>
<li>Infinity 1(0)+ for Posit without NaN, otherwise NaN 1(0)+</li>
<li>+Infinity 0(1)+ for Posits with NaN</li>
<li>one is 001(0)+</li>
<li>two is 010(E=1)0+ where E is over e bits, that is 010(0){-1}0?</li>
<li>1/2 is 001(Emax)0+ where E is ove e bits, that is 001(1){e}0?</li>
<li>fractionary numbers have inversion bit 0</li>
</ul>
<p>Above we used the EBNF like notation for expressing the bit patterns.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Approach</h1>
<p>Everything is template based and we define three key types: Posit, Posit Trait, UnpackedPosit, Unpacked</p>
<ul>
<li>Posit: is the key class</li>
<li>Posit Trait: provides special numbers and some L1 operations</li>
<li>UnpackedPosit is the docomposition of the posit its constituent parts (type, regime, exponent, fraction)</li>
<li>Unpacked is a softfloat with (sign, exponent, fraction)</li>
</ul>
<p>Then there are several Backends:</p><ul>
<li>softfloat backend that implements L4 operations using Unpacked</li>
<li>fixed point backend</li>
<li>floating point backend based on the conversion of posit to native single or double</li>
</ul>
<p>Posit is parametrized as follows:</p><ul>
<li>storage type (signed integer, e.g. 16,32,64 bit)</li>
<li>number of bits of the posit (&lt;= of the storage type)</li>
<li>number of bits of the exponent (fixed as in bfp)</li>
<li>type for expression the fraction or the Backend. If this type is a floating point then it is</li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
Install</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Prepare softfloat</h2>
<p>Under Linux softfloat can be fully embedded</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Build using Docker</h2>
<p>Dockerfile FROM alpine:3.7 RUN apk update RUN apk add &ndash;no-cache gcc musl-dev g++ cmake python3 make bash cling</p>
<p>Run docker run &ndash;rm -i -v :/tmp alpinegxx bash</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Usage</h1>
<p>Interface with Eigen is possible with possible optimizations</p>
<p>Eventually it is possible to use cling</p>
<p>cling -D "POSIT_TYPE=Posit&lt;int8_t,8,2,uint8_t&gt;" ".x listposits.cpp"</p>
<p>For loading lbraries: </p><pre class="fragment">    #pragma cling add_library_path("path")
    #pragma cling load("softfloat")
    #pragma cling add_include_path("inc_directory")
</pre><h1><a class="anchor" id="autotoc_md14"></a>
Testing Posit12</h1>
<p>scripts/listpositany.sh ignore -DPOSIT_TYPEID=posit12 &gt; a scripts/listpositany.sh int16_t,12,2,uint16_t,false &gt; b</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Contributing</h1>
<p>Contributions can be added using github issue tracking and pull requests, any contributions is welcomed.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Contributors</h2>
<ul>
<li>Emanuele Ruffaldi (main developer)</li>
<li>Marco Cococcioni (UNIPI)</li>
<li>Federico Rossi (UNIPI)</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
References</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Publications using cppPosit</h2>
<h2><a class="anchor" id="autotoc_md19"></a>
Other Posit Libraries</h2>
<h2><a class="anchor" id="autotoc_md20"></a>
Related Libraries</h2>
<ul>
<li>Fixed Point Library <a href="https://github.com/johnmcfarlane/cnl">https://github.com/johnmcfarlane/cnl</a> fixed_point&lt;int, -1&gt; make_fixed&lt;30, 1&gt; Special: elastic_fixed_point based on elastic_intger</li>
<li>MPFR Boost Multiprecision: big integer could replace the fractional part, big float could replace unpacked at all</li>
<li>fptemplate (from here <a href="https://www.edwardrosten.com/code/fp_template.html">https://www.edwardrosten.com/code/fp_template.html</a> and githubbed here <a href="https://github.com/eruffaldi/fptemplate">https://github.com/eruffaldi/fptemplate</a>)</li>
<li>constexpr C++14 (not used yet) <a href="https://github.com/elbeno/constexpr">https://github.com/elbeno/constexpr</a></li>
<li>FP16&lt;-&gt;Integer or &lt;-&gt; Float <a href="https://github.com/Maratyszcza/FP16">https://github.com/Maratyszcza/FP16</a> <a href="https://fgiesen.wordpress.com/2012/03/28/half-to-float-done-quic/">https://fgiesen.wordpress.com/2012/03/28/half-to-float-done-quic/</a> <a href="https://gist.github.com/rygorous/2156668">https://gist.github.com/rygorous/2156668</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
External references</h2>
<ul>
<li>FP Guide: <a href="https://floating-point-gui.de/">https://floating-point-gui.de/</a></li>
<li>Blinn Tricks: <a href="https://ieeexplore.ieee.org/document/595279">https://ieeexplore.ieee.org/document/595279</a> also on p123 of <a href="https://files.cnblogs.com/files/mavaL/blinn.pdf">https://files.cnblogs.com/files/mavaL/blinn.pdf</a></li>
<li>Blog: <a href="https://randomascii.wordpress.com/2012/01/11/tricks-with-the-floating-point-format/">https://randomascii.wordpress.com/2012/01/11/tricks-with-the-floating-point-format/</a> <a href="https://randomascii.wordpress.com/2012/01/23/stupid-float-tricks-2/">https://randomascii.wordpress.com/2012/01/23/stupid-float-tricks-2/</a></li>
<li>What everybody shohuld know about FP: <a href="http://www.physics.mcgill.ca/~patscott/teaching/numeric/Goldberg.pdf">http://www.physics.mcgill.ca/~patscott/teaching/numeric/Goldberg.pdf</a></li>
<li>Slides: <a href="http://www.it.uu.se/edu/course/homepage/dark/ht11/floating-point-details.pdf">http://www.it.uu.se/edu/course/homepage/dark/ht11/floating-point-details.pdf</a></li>
<li>Handbook of FP Arithmetics, Muller &amp; co (Book, 579pp): <a href="http://perso.ens-lyon.fr/jean-michel.muller/Handbook.html">http://perso.ens-lyon.fr/jean-michel.muller/Handbook.html</a></li>
<li>Fixed Point sg14: <a href="https://github.com/johnmcfarlane/fixed_point/blob/develop/doc/p0037.md">https://github.com/johnmcfarlane/fixed_point/blob/develop/doc/p0037.md</a></li>
<li>Fixed Point Compositional (after sg14): <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/p0554r0.html">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2017/p0554r0.html</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
